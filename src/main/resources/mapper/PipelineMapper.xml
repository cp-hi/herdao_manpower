<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="net.herdao.hdp.manpower.mpclient.mapper.PipelineMapper">

    <resultMap id="pipelineMap" type="pipeline">
        <association property="group" column="group_id" select="getGroup" javaType="group"/>
    </resultMap>

    <select id="query" resultMap="pipelineMap" parameterType="String">
        <bind name="likeTxt" value="'%'+searchTxt+'%'"/>
        select * from mp_pipeline where pipeline_code like #{likeTxt} or pipeline_name like #{likeTxt}
    </select>

    <select id="getGroup" parameterType="int" resultType="group">
        select * from  mp_group WHERE id=#{id}
    </select>

    <select id="pipelineList" parameterType="pipeline" resultType="map">
       	select id,pipeline_code AS code,pipeline_name AS name   from mp_pipeline where group_id = #{groupId}
    </select>

    <select id="chkDuplicatePipelineCode" parameterType="pipeline" resultType="boolean">
         SELECT count(*) from mp_Pipeline where  (#{id} is null or  id != #{id})  and  pipeline_code = #{pipelineCode}
    </select>

    <select id="chkDuplicatePipelineName" parameterType="pipeline" resultType="boolean">
      SELECT count(*) from mp_Pipeline where   (#{id} is null or  id != #{id})    and pipeline_name = #{pipelineName}
    </select>

    <select id="getPipelineCodesByGroupId" parameterType="long" resultType="String">
      SELECT pipeline_code from mp_Pipeline where group_id = #{groupId}
    </select>

</mapper>
